# 分销奖励功能 PRD

## 文档信息

| 项目 | 内容 |
|-----|------|
| 文档版本 | v1.0 |
| 创建日期 | 2026-01-14 |
| 产品模块 | 商户端 + 平台端 - 会员服务 |
| 功能入口 | 商户后台 > 会员服务 > 分销奖励<br>平台后台 > 会员管理 > 分销管理 |
| 文档状态 | 已实现 ✅ |

---

## 一、功能概述

### 1.1 功能定位

分销奖励功能是基于会员邀请关系的激励体系，商户邀请的会员在平台下单并离店后，商户可获得分销奖励。平台端可统一查看和管理所有商户的分销数据。

### 1.2 核心价值

- **商户价值**：通过邀请会员获得持续分销收益，激励客户拓展
- **平台价值**：构建分销网络，提升商户积极性，扩大用户基数
- **监管价值**：平台统一管理分销数据，支持数据导出和分析

---

## 二、功能架构

### 2.1 双端设计

```
分销奖励体系
├── 商户端
│   └── 分销奖励（查看自己的分销收益记录）
└── 平台端
    └── 分销管理（查看所有商户的分销数据）
```

### 2.2 业务流程

```
商户邀请会员
    ↓
会员注册成功
    ↓
会员在平台下单
    ↓
会员支付成功
    ↓
会员完成入住
    ↓
会员离店（check-out）
    ↓
计入分销奖励 ✅
    ↓
商户端查看分销奖励
平台端查看分销管理
```

---

## 三、商户端 - 分销奖励

### 3.1 功能描述

商户查看自己邀请的会员产生的分销订单和收益记录。

### 3.2 页面入口

**路径**：商户后台 > 会员服务 > 分销奖励

**路由**：`/merchant-backend/invite-member/commission`

### 3.3 页面布局

```
┌──────────────────────────────────────────────┐
│ ← 返回    分销奖励                           │
├──────────────────────────────────────────────┤
│ ℹ 受邀会员在平台下单，离店后，将会计入分销奖励  │
├──────────────────────────────────────────────┤
│ 分销奖励列表                                  │
│ ┌────┬──────┬──────┬────┬────┐             │
│ │订单│受邀  │下单  │离店│支付│             │
│ │号  │会员  │时间  │日期│金额│             │
│ └────┴──────┴──────┴────┴────┘             │
│ 分页：共 XX 条                                │
└──────────────────────────────────────────────┘
```

### 3.4 列表字段

| 列名 | 宽度 | 数据类型 | 说明 |
|------|------|---------|------|
| 订单号 | 140px | 文本 | 订单编号 |
| 受邀会员 | 120px | 文本 | 会员手机号 |
| 下单时间 | 120px | 日期时间 | 分行显示：日期+时间 |
| 离店日期 | 100px | 日期 | YYYY-MM-DD |
| 支付金额 | 100px | 金额 | ¥XXX.XX |

### 3.5 数据说明

**提示信息**：
> 受邀会员在平台下单，离店后，将会计入分销奖励

**计入时机**：
- ✅ 会员下单
- ✅ 支付成功
- ✅ 完成入住
- ✅ **离店后** ← 关键时机

**不计入情况**：
- ❌ 未支付的订单
- ❌ 支付后取消的订单
- ❌ 尚未离店的订单

---

## 四、平台端 - 分销管理

### 4.1 功能描述

平台统一查看所有商户的分销数据，支持按时间筛选和数据导出。

### 4.2 页面入口

**路径**：平台后台 > 会员管理 > 分销管理

**路由**：`/platform-admin/member-management/commission`

### 4.3 页面布局

```
┌──────────────────────────────────────────────┐
│ 分销管理                        [导出数据]   │
├──────────────────────────────────────────────┤
│ ℹ 受邀会员在平台下单，离店后，将会计入分销奖励  │
│ 离店日期： [2025年 ▼]  [1月 ▼]               │
├──────────────────────────────────────────────┤
│ 分销记录列表                                  │
│ ┌────┬────┬──────┬──────┬────┬────┐       │
│ │商户│订单│受邀  │下单  │离店│支付│       │
│ │名称│号  │会员  │时间  │日期│金额│       │
│ └────┴────┴──────┴──────┴────┴────┘       │
│ 分页：共 XX 条                                │
└──────────────────────────────────────────────┘
```

### 4.4 筛选功能

**离店日期筛选**：
- 年份选择：下拉框（2025年、2024年...）
- 月份选择：下拉框（1月-12月）
- 筛选逻辑：按离店日期过滤记录

### 4.5 列表字段

| 列名 | 宽度 | 数据类型 | 说明 |
|------|------|---------|------|
| 商户名称 | 150px | 文本 | 邀请会员的商户 |
| 订单号 | 140px | 文本 | 订单编号 |
| 受邀会员 | 120px | 文本 | 会员手机号 |
| 下单时间 | 120px | 日期时间 | 分行显示 |
| 离店日期 | 100px | 日期 | YYYY-MM-DD |
| 支付金额 | 100px | 金额 | ¥XXX.XX |

### 4.6 导出功能

**导出按钮**：
- 位置：页面右上角
- 文字："导出数据"
- 加载状态：显示loading动画

**导出内容**：
- 导出当前筛选条件下的所有数据
- 文件格式：Excel (.xlsx)
- 文件名：`分销管理_{年份}_{月份}.xlsx`

---

## 五、数据结构

### 5.1 分销奖励记录

```typescript
interface CommissionRecord {
  id: string             // 记录ID
  orderNo: string        // 订单号
  inviteePhone: string   // 受邀会员手机号
  orderTime: string      // 下单时间
  checkOutTime: string   // 离店时间
  paymentAmount: number  // 支付金额（元）
  merchantName?: string  // 商户名称（平台端）
}
```

### 5.2 筛选条件

```typescript
interface CommissionFilters {
  year?: string   // 年份：'2025'
  month?: number  // 月份：1-12
}
```

---

## 六、业务规则

### 6.1 分销关系建立

1. 商户通过"邀请会员"功能邀请客户
2. 客户成为"受邀会员"
3. 建立永久分销关系（商户 ← 受邀会员）

### 6.2 分销奖励触发条件

**必须同时满足**：
1. ✅ 受邀会员身份
2. ✅ 在平台下单
3. ✅ 支付成功
4. ✅ 完成入住
5. ✅ **离店完成**

### 6.3 分销奖励计算

**触发时机**：离店日期当天
**计入数据**：订单信息 + 支付金额
**不考虑**：订单取消、退款

---

## 七、商户端与平台端对比

| 维度 | 商户端 | 平台端 |
|------|--------|--------|
| **查看范围** | 仅自己邀请的会员 | 所有商户 |
| **筛选功能** | 无 | 按年月筛选 |
| **导出功能** | 无 | 支持导出Excel |
| **显示字段** | 不显示商户名称 | 显示商户名称 |
| **入口路径** | 会员服务 > 分销奖励 | 会员管理 > 分销管理 |

---

## 八、技术实现

### 8.1 关键文件

| 文件 | 路径 | 说明 |
|------|------|------|
| 商户端页面 | `src/views/MerchantBackend/MemberService/CommissionRewardsPage.vue` | 分销奖励查询 |
| 平台端页面 | `src/views/PlatformAdmin/MemberManagement/CommissionManagementPage.vue` | 分销管理 |
| API接口 | `src/api/memberService.ts` | 会员服务API |

### 8.2 核心技术栈

- Vue 2.6.12 + Composition API
- TypeScript 5.6.3
- Ant Design Vue 1.7.8
- Day.js 1.11.13
- XLSX 0.18.5（数据导出）

---

## 九、待实现功能

### 9.1 API接入

1. 商户端分销奖励查询API
2. 平台端分销管理查询API
3. 平台端数据导出API

### 9.2 功能增强

4. 分销金额计算和显示
5. 分销统计汇总
6. 高级筛选功能
7. 数据分析图表

---

## 十、验收标准

### 10.1 功能验收

- [ ] 商户端显示自己邀请的会员订单
- [ ] 平台端显示所有商户的分销数据
- [ ] 筛选功能正常（年月筛选）
- [ ] 分页功能正常
- [ ] 金额显示正确（¥XXX.XX）
- [ ] 日期时间格式正确

### 10.2 数据验收

- [ ] 仅显示离店后的订单
- [ ] 订单信息完整准确
- [ ] 分销关系正确匹配

---

**文档编写**：Claude Sonnet 4.5
**最后更新**：2026-01-14
